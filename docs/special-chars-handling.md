# TTS特殊字符处理功能说明

## 概述

TTS语音合成应用现在具备了强大的特殊字符处理功能，能够智能处理各种格式的文本，优化语音合成效果。

## 处理的特殊字符类型

### 1. Markdown格式字符
- **加粗标记**: `**文本**` → 保留文本内容，移除标记
- **斜体标记**: `*文本*` → 保留文本内容，移除标记  
- **代码标记**: `` `代码` `` → 保留代码内容，移除反引号
- **标题标记**: `### 标题` → 保留标题内容，移除井号
- **链接标记**: `[文本](URL)` → 只保留显示文本

### 2. 转义字符
系统能正确处理各种转义序列：
- `\*\*粗体\*\*` → `**粗体**`
- `\"引号\"` → `"引号"`
- `\&符号\&` → `&符号&`
- `\n` → 空格（换行转空格）
- `\t` → 空格（制表符转空格）

### 3. 特殊符号
对常见特殊符号进行语音友好的转换：
- `&` → `和`
- `@` → `at`
- `#` → `井号`
- `$` → `美元`
- `%` → `百分号`
- `^` → `上标`
- `*` → `星号`
- 其他符号类似处理

### 4. 中英文混合文本
- 自动在中英文之间添加适当的停顿空格
- 示例：`AI Agent可以automatically处理various任务` → `AI Agent 可以 automatically 处理 various 任务`

### 5. 各种括号
智能处理多种括号类型：
- 中文括号：`（内容）`
- 英文括号：`(内容)`
- 方括号：`【内容】`、`[内容]`
- 书名号：`《书名》`
- 引号：`"内容"`、`'内容'`

## 智能文本过滤

### 自动跳过的内容
- 空行和纯空白行
- 纯标记行（如 `###`、`**`、`-----`）
- 太短的文本（少于2个字符）
- 不包含有效内容的文本行

### 保留的内容
- 包含字母、数字或中文字符的文本
- 混合格式的正常文本行
- 经过预处理后的有效内容

## 使用示例

### 输入文本
```
**代理（Agents）** - 应用处理方式
\*\*粗体\*\* - 反斜杠转义处理
！@#$%^&*() - 特殊符号处理
AI Agent可以automatically处理various任务 - 中英混合
（中文括号）和(英文括号) - 括号处理
### 标题行 - 会被跳过
***标记行*** - 会被跳过
```

### 处理结果
- `代理（Agents） - 应用处理方式`
- `**粗体** - 反斜杠转义处理`
- `！at井号美元百分号上标和星号() - 特殊符号处理`
- `AI Agent 可以 automatically 处理 various 任务 - 中英混合`
- `（中文括号）和 (英文括号) - 括号处理`
- 标题行和标记行被自动跳过

## 配置选项

文本处理器支持以下配置选项：

```go
textProcessor := NewTextProcessor()
textProcessor.SetOptions(
    preserveMarkdown,     // 是否处理Markdown格式
    normalizeWhitespace,  // 是否规范化空白字符
    handleSpecialSymbols, // 是否处理特殊符号
)
```

## 技术实现

### 文本处理流程
1. **Markdown格式处理** - 移除格式标记，保留内容
2. **转义字符处理** - 还原转义序列
3. **特殊符号处理** - 转换为语音友好格式
4. **空白字符规范化** - 统一空格和换行
5. **中英文混合处理** - 添加适当停顿
6. **括号处理** - 保持自然语调

### 性能优化
- 使用正则表达式进行高效模式匹配
- 批量处理减少重复操作
- 智能过滤避免无效处理

## 测试验证

使用测试文件 `test_special_chars.txt` 验证各种特殊字符的处理效果：

```bash
# 测试特殊字符处理
./tts_app tts -i test_special_chars.txt -o output_special

# 查看处理统计
# 输出会显示：文本处理统计: 总行数=X, 有效行数=Y, 跳过行数=Z
```

## 注意事项

1. **文本长度**: 建议每行文本长度适中，避免过长或过短
2. **特殊符号**: 某些符号可能会影响TTS效果，系统会自动优化
3. **语言混合**: 中英文混合时会自动添加停顿，提升语音效果
4. **格式标记**: Markdown等格式标记会被智能处理，不影响语音内容

## 更新日志

- 新增智能文本预处理功能
- 支持Markdown格式字符处理
- 优化转义字符处理
- 改进中英文混合文本处理
- 增强特殊符号转换
- 智能文本过滤和验证
